<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <title>My</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <script>
        const brokerUrl = 'wss://damoa.io:9002';
        const clientId = 'iot-client-' + Math.random().toString(16).substr(2, 8);

        const options = {
            clientId: clientId,
        };

        console.log(`MQTT ë¸Œë¡œì»¤(${brokerUrl}) ì ‘ì† ì‹œë„`);
        const client = mqtt.connect(brokerUrl, options);

        client.on('connect', () => {
            console.log(`ì ‘ì† ì„±ê³µ! (ID: ${clientId})`);

            // ğŸ“Œ êµìˆ˜ë‹˜ì´ ì‹¤ì œ publish ì¤‘ì¸ í† í”½
            const topic = 'ewha/0317137263';
            client.subscribe(topic, (err) => {
                if (!err) {
                    console.log(`í† í”½ êµ¬ë… ì„±ê³µ: ${topic}`);
                    client.publish('ewha/checkin', '2270006 ê³ ì§€í¬');
                } else {
                    console.error('êµ¬ë… ì˜¤ë¥˜:', err);
                }
            });
        });

        client.on('message', (topic, message) => {
            const mainDiv = document.getElementById('main');
            const msg = message.toString();
            console.log(msg);

            const html = `
                <div class="message-item">
                    <span>${msg}</span>
                </div>
            `;
            mainDiv.innerHTML = html;
            mainDiv.scrollTop = mainDiv.scrollHeight;
        });

        client.on('error', (err) => {
            console.error('ì—°ê²° ì˜¤ë¥˜:', err);
            client.end();
        });
    </script>
</head>

<body>
    <h3>ë‚˜ì˜ ì›¹(2270006, ê³ ì§€í¬)</h3>
    <div id="main"></div>
</body>
</html>
