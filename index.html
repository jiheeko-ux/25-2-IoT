
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <title>My</title>
   
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <script>
        const brokerUrl = 'wss://damoa.io:9002';
    
        // ê³ ìœ í•œ í´ë¼ì´ì–¸íŠ¸ ID ìƒì„± (ë‹¤ë¥¸ ì‚¬ìš©ìì™€ ì¶©ëŒ ë°©ì§€)
        const clientId = 'iot-client-' + Math.random().toString(16).substr(2, 8);
        
        // ë³„ë„ ì¸ì¦ì´ í•„ìš” ì—†ìœ¼ë¯€ë¡œ options ê°ì²´ëŠ” ê°„ë‹¨í•˜ê²Œ clientIdë§Œ í¬í•¨
        const options = {
          clientId: clientId,
        };
    
        console.log(`MQTT ë¸Œë¡œì»¤(${brokerUrl})ì— ì ‘ì†ì„ ì‹œë„í•©ë‹ˆë‹¤...`);
        const client = mqtt.connect(brokerUrl, options);
    
        // 1. ë¸Œë¡œì»¤ ì ‘ì† ì„±ê³µ ì‹œ ì‹¤í–‰ë˜ëŠ” ì´ë²¤íŠ¸
        client.on('message', (topic, message) => {
          const s = message.toString();
          const mainDiv = document.getElementById('main');
          const now = new Date().toLocaleTimeString();

          // JSONì´ë©´ íŒŒì‹±í•´ì„œ ì˜¨ë„/ìŠµë„ í‘œì‹œ
          let line = '';
          try {
            const obj = JSON.parse(s);
            const t = obj.temperature ?? obj.temp ?? obj.T;
            const h = obj.humidity ?? obj.hum ?? obj.H;
            if (t !== undefined || h !== undefined) {
              line = `ğŸ“¥ <b>${topic}</b> <small>${now}</small> â€” T: ${t}â„ƒ, H: ${h}%`;
            } else {
              line = `ğŸ“¥ <b>${topic}</b> <small>${now}</small> â€” ${s}`;
            }
          } catch(_) {
            // ì¼ë°˜ í…ìŠ¤íŠ¸
            line = `ğŸ“¥ <b>${topic}</b> <small>${now}</small> â€” ${s}`;
          }
        
          // ìƒˆ ì¤„ì„ â€œì¶”ê°€â€
          const div = document.createElement('div');
          div.className = 'message-item';
          div.innerHTML = line;
          mainDiv.appendChild(div);
        
          // ìµœì‹  ë©”ì‹œì§€ ë³´ì´ê²Œ ìŠ¤í¬ë¡¤
          mainDiv.scrollTop = mainDiv.scrollHeight;
        
          // (ì„ íƒ) ë„ˆë¬´ ë§ì•„ì§€ë©´ ì•ì—ì„œ ì œê±°
          if (mainDiv.children.length > 200) mainDiv.removeChild(mainDiv.firstChild);
        });

    </script>
</head>
    
<body>
  <h3>ë‚˜ì˜ ì›¹(2270006, ê³ ì§€í¬)</h3>
  <div id="status">ì—°ê²° ì¤€ë¹„â€¦</div>
  <div id="main"></div>
</body>
</html>
